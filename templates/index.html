<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Симулятор дифракции электронов</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 20px;
        }
        .container { max-width: 1600px; margin: 0 auto; }
        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle { text-align: center; color: #888; margin-bottom: 30px; font-size: 1.1em; }
        .main-content { display: grid; grid-template-columns: 380px 1fr; gap: 30px; }
        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: fit-content;
        }
        .control-section { margin-bottom: 25px; }
        .control-section h3 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 1px solid rgba(0, 212, 255, 0.3);
            padding-bottom: 8px;
        }
        .control-group { margin-bottom: 15px; }
        .control-group label { display: block; margin-bottom: 5px; color: #b0b0b0; font-size: 0.9em; }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #2a2a4a;
            outline: none;
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #7b2cbf);
            cursor: pointer;
        }
        input[type="number"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #e0e0e0;
            font-size: 14px;
        }
        select { cursor: pointer; }
        .value-display { text-align: right; color: #00d4ff; font-size: 0.85em; margin-top: 3px; }
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        .btn-primary { background: linear-gradient(135deg, #00d4ff, #7b2cbf); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px;
            font-size: 0.9em;
        }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.2); }
        .results-panel { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .result-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .result-card h3 { text-align: center; margin-bottom: 15px; color: #00d4ff; font-size: 1em; }
        .result-card.fresnel h3 { color: #ff6b6b; }
        .result-card.fraunhofer h3 { color: #4ecdc4; }
        .image-container {
            width: 100%;
            aspect-ratio: 1;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .image-container img { width: 100%; height: 100%; object-fit: contain; }
        .placeholder { color: #555; font-size: 0.9em; text-align: center; padding: 20px; }
        .aperture-options { display: none; }
        .aperture-options.active { display: block; }
        .file-input-wrapper { position: relative; overflow: hidden; display: inline-block; width: 100%; }
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        .file-input-label {
            display: block;
            padding: 10px;
            background: rgba(0, 212, 255, 0.2);
            border: 1px dashed rgba(0, 212, 255, 0.5);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .file-input-label:hover { background: rgba(0, 212, 255, 0.3); }
        .loading { display: none; text-align: center; padding: 20px; }
        .loading.active { display: block; }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 212, 255, 0.3);
            border-top-color: #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .info-panel {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            font-size: 0.85em;
        }
        .info-panel p { margin: 5px 0; }
        .info-panel span { color: #00d4ff; }
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 2px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .matrix-cell {
            aspect-ratio: 1;
            background: #2a2a4a;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 2px;
        }
        .matrix-cell:hover { border-color: #00d4ff; }
        .matrix-cell.active { background: #ffffff; box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
        .matrix-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .matrix-buttons .btn { flex: 1; min-width: 80px; }
        .warning-box {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .warning-box h4 { color: #ff6b6b; margin-bottom: 10px; }
        .checkbox-group { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .checkbox-group input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
        .checkbox-group label { color: #b0b0b0; font-size: 0.9em; cursor: pointer; }
        .theory-section {
            margin-top: 40px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .theory-section h2 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .theory-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .theory-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            border-left: 4px solid #00d4ff;
        }
        .theory-card.fresnel-theory { border-left-color: #ff6b6b; }
        .theory-card.fraunhofer-theory { border-left-color: #4ecdc4; }
        .theory-card.algorithm-theory { border-left-color: #7b2cbf; }
        .theory-card h3 { color: #00d4ff; margin-bottom: 15px; font-size: 1.2em; }
        .theory-card.fresnel-theory h3 { color: #ff6b6b; }
        .theory-card.fraunhofer-theory h3 { color: #4ecdc4; }
        .theory-card.algorithm-theory h3 { color: #7b2cbf; }
        .theory-card p, .theory-card li { line-height: 1.6; margin-bottom: 10px; color: #b0b0b0; }
        .theory-card ul { margin-left: 20px; margin-bottom: 10px; }
        .formula {
            background: rgba(0, 212, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            text-align: center;
            margin: 15px 0;
            color: #00d4ff;
            font-size: 1.1em;
            overflow-x: auto;
        }
        .highlight { color: #00d4ff; font-weight: bold; }
        @media (max-width: 1200px) {
            .main-content { grid-template-columns: 1fr; }
            .results-panel { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            .results-panel { grid-template-columns: 1fr; }
            .theory-cards { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Симулятор дифракции электронов</h1>
    <p class="subtitle">Специализированные алгоритмы для каждого типа апертуры</p>

    <div class="main-content">
        <div class="control-panel">
            <div class="control-section">
                <h3>Тип апертуры</h3>
                <div class="control-group">
                    <select id="apertureType" onchange="updateApertureOptions()">
                        <option value="single">Одиночная щель (аналитика)</option>
                        <option value="double">Двойная щель (аналитика)</option>
                        <option value="triple">Тройная щель (аналитика)</option>
                        <option value="n_slit">N щелей — решётка (аналитика)</option>
                        <option value="circle">Круглое отверстие (Бессель)</option>
                        <option value="image">Из изображения (интеграл)</option>
                        <option value="matrix">Из матрицы (интеграл)</option>
                    </select>
                </div>

                <div id="slitOptions" class="aperture-options active">
                    <div class="control-group">
                        <label>Ширина щели (пиксели)</label>
                        <input type="range" id="slitWidth" min="2" max="100" value="20" oninput="updateValue('slitWidth')">
                        <div class="value-display" id="slitWidthValue">20</div>
                    </div>
                    <div class="control-group" id="separationGroup">
                        <label>Расстояние между щелями (пиксели)</label>
                        <input type="range" id="slitSeparation" min="20" max="200" value="60" oninput="updateValue('slitSeparation')">
                        <div class="value-display" id="slitSeparationValue">60</div>
                    </div>
                </div>

                <div id="nSlitOptions" class="aperture-options">
                    <div class="control-group">
                        <label>Количество щелей</label>
                        <input type="range" id="nSlits" min="2" max="20" value="5" oninput="updateValue('nSlits')">
                        <div class="value-display" id="nSlitsValue">5</div>
                    </div>
                    <div class="control-group">
                        <label>Ширина щели (пиксели)</label>
                        <input type="range" id="nSlitWidth" min="2" max="50" value="10" oninput="updateValue('nSlitWidth')">
                        <div class="value-display" id="nSlitWidthValue">10</div>
                    </div>
                    <div class="control-group">
                        <label>Период решётки (пиксели)</label>
                        <input type="range" id="nSlitSeparation" min="20" max="100" value="40" oninput="updateValue('nSlitSeparation')">
                        <div class="value-display" id="nSlitSeparationValue">40</div>
                    </div>
                </div>

                <div id="circleOptions" class="aperture-options">
                    <div class="control-group">
                        <label>Радиус (пиксели)</label>
                        <input type="range" id="circleRadius" min="5" max="150" value="40" oninput="updateValue('circleRadius')">
                        <div class="value-display" id="circleRadiusValue">40</div>
                    </div>
                </div>

                <div id="imageOptions" class="aperture-options">
                    <div class="control-group">
                        <label>Загрузить изображение (белый = щель)</label>
                        <div class="file-input-wrapper">
                            <span class="file-input-label" id="fileLabel">Нажмите для выбора изображения</span>
                            <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">
                        </div>
                    </div>
                    <div class="warning-box">
                        <h4>Произвольная апертура</h4>
                        <p>Используется численный интеграл Кирхгофа-Френеля. Расчёт может занять больше времени.</p>
                    </div>
                </div>

                <div id="matrixOptions" class="aperture-options">
                    <div class="control-group">
                        <label>Нажмите на ячейки для создания апертуры</label>
                        <div class="matrix-grid" id="matrixGrid"></div>
                        <div class="matrix-buttons">
                            <button class="btn btn-secondary" onclick="clearMatrix()">Очистить</button>
                            <button class="btn btn-secondary" onclick="fillAll()">Заполнить</button>
                            <button class="btn btn-secondary" onclick="invertMatrix()">Инвертировать</button>
                            <button class="btn btn-secondary" onclick="randomMatrix()">Случайно</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="control-section">
                <h3>Физические параметры</h3>
                <div class="control-group">
                    <label>Расстояние до экрана (м)</label>
                    <input type="range" id="screenDistance" min="0.01" max="10" step="0.01" value="1" oninput="updateValue('screenDistance')">
                    <div class="value-display" id="screenDistanceValue">1.00 м</div>
                </div>
                <div class="control-group">
                    <label>Количество электронов</label>
                    <input type="range" id="numElectrons" min="10000" max="1000000" step="10000" value="100000" oninput="updateValue('numElectrons')">
                    <div class="value-display" id="numElectronsValue">100 000</div>
                </div>
                <div class="control-group">
                    <label>Длина волны (пм)</label>
                    <input type="range" id="wavelength" min="1" max="100" value="5" oninput="updateValue('wavelength')">
                    <div class="value-display" id="wavelengthValue">5 пм</div>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="showAnalytical">
                    <label for="showAnalytical">Показать чистую аналитику (без статистики)</label>
                </div>
            </div>

            <button class="btn btn-primary" id="calculateBtn" onclick="calculate()">Рассчитать дифракцию</button>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Расчёт дифракционных картин...</p>
            </div>

            <div class="info-panel" id="infoPanel" style="display: none;">
                <p>Число Френеля: <span id="fresnelNumber">-</span></p>
                <p>Режим: <span id="regimeInfo">-</span></p>
                <p>Алгоритм: <span id="algorithmInfo">-</span></p>
                <p>Электронов: <span id="electronCount">-</span></p>
                <p>Расстояние: <span id="distanceInfo">-</span></p>
            </div>
        </div>

        <div class="results-panel">
            <div class="result-card">
                <h3>Апертура</h3>
                <div class="image-container">
                    <img id="apertureImage" style="display: none;">
                    <span class="placeholder" id="aperturePlaceholder">Апертура появится здесь</span>
                </div>
            </div>
            <div class="result-card fresnel">
                <h3>Дифракция Френеля (ближняя зона)</h3>
                <div class="image-container">
                    <img id="fresnelImage" style="display: none;">
                    <span class="placeholder" id="fresnelPlaceholder">Картина Френеля появится здесь</span>
                </div>
            </div>
            <div class="result-card fraunhofer">
                <h3>Дифракция Фраунгофера (дальняя зона)</h3>
                <div class="image-container">
                    <img id="fraunhoferImage" style="display: none;">
                    <span class="placeholder" id="fraunhoferPlaceholder">Картина Фраунгофера появится здесь</span>
                </div>
            </div>
        </div>
    </div>

    <div class="theory-section">
        <h2>Теория и алгоритмы</h2>
        <div class="theory-cards">
            <div class="theory-card algorithm-theory">
                <h3>Разные алгоритмы для разных апертур</h3>
                <p>Этот симулятор использует <span class="highlight">специализированные алгоритмы</span> для каждого типа апертуры:</p>
                <ul>
                    <li><strong>Щели:</strong> Аналитические формулы через sinc-функции</li>
                    <li><strong>Круглое отверстие:</strong> Функция Бесселя J1 (диск Эйри)</li>
                    <li><strong>Произвольная форма:</strong> Численный интеграл Кирхгофа-Френеля</li>
                </ul>
            </div>
            <div class="theory-card">
                <h3>Одиночная щель</h3>
                <p>Аналитическое решение для одиночной щели шириной b:</p>
                <div class="formula">I(θ) = I₀ · sinc²(πb·sin(θ)/λ)</div>
            </div>
            <div class="theory-card">
                <h3>Двойная и N щелей</h3>
                <p>Для системы из N щелей с периодом d:</p>
                <div class="formula">I(θ) = I₀ · sinc²(β) · [sin(Nα)/sin(α)]²</div>
            </div>
            <div class="theory-card">
                <h3>Круглое отверстие (диск Эйри)</h3>
                <p>Дифракция на круглом отверстии диаметром D:</p>
                <div class="formula">I(θ) = I₀ · [2·J₁(x)/x]²</div>
                <p>Первый минимум при: sin(θ₁) ≈ 1.22·λ/D</p>
            </div>
            <div class="theory-card fresnel-theory">
                <h3>Дифракция Френеля</h3>
                <p>В ближней зоне (число Френеля F > 1) используется интеграл Френеля-Кирхгофа:</p>
                <div class="formula">U(P) = (1/iλ) ∫∫ T(ξ,η) · exp(ikr)/r · K(θ) dS</div>
                <p>Число Френеля: F = a²/(λ·z)</p>
            </div>
            <div class="theory-card fraunhofer-theory">
                <h3>Дифракция Фраунгофера</h3>
                <p>В дальней зоне (F << 1) интенсивность пропорциональна квадрату модуля Фурье-образа апертуры:</p>
                <div class="formula">I(x,y) ∝ |F[T(ξ,η)]|²</div>
            </div>
            <div class="theory-card">
                <h3>Дифракция электронов</h3>
                <p>Электроны обладают волновыми свойствами. Длина волны де Бройля:</p>
                <div class="formula">λ = h/p = h/(m·v)</div>
                <p>При 100 кэВ: λ ≈ 4 пм (пикометра)</p>
            </div>
        </div>
    </div>
</div>

<script>
    let uploadedImage = null;
    let matrix = [];

    function initMatrix() {
        const grid = document.getElementById('matrixGrid');
        grid.innerHTML = '';
        matrix = [];
        for (let i = 0; i < 10; i++) {
            matrix[i] = [];
            for (let j = 0; j < 10; j++) {
                matrix[i][j] = 0;
                const cell = document.createElement('div');
                cell.className = 'matrix-cell';
                cell.dataset.row = i;
                cell.dataset.col = j;
                cell.onclick = function() { toggleCell(i, j, this); };
                grid.appendChild(cell);
            }
        }
    }

    function toggleCell(row, col, element) {
        matrix[row][col] = matrix[row][col] === 0 ? 1 : 0;
        element.classList.toggle('active');
    }

    function clearMatrix() {
        const cells = document.querySelectorAll('.matrix-cell');
        cells.forEach((cell, index) => {
            const row = Math.floor(index / 10);
            const col = index % 10;
            matrix[row][col] = 0;
            cell.classList.remove('active');
        });
    }

    function fillAll() {
        const cells = document.querySelectorAll('.matrix-cell');
        cells.forEach((cell, index) => {
            const row = Math.floor(index / 10);
            const col = index % 10;
            matrix[row][col] = 1;
            cell.classList.add('active');
        });
    }

    function invertMatrix() {
        const cells = document.querySelectorAll('.matrix-cell');
        cells.forEach((cell, index) => {
            const row = Math.floor(index / 10);
            const col = index % 10;
            matrix[row][col] = matrix[row][col] === 0 ? 1 : 0;
            cell.classList.toggle('active');
        });
    }

    function randomMatrix() {
        const cells = document.querySelectorAll('.matrix-cell');
        cells.forEach((cell, index) => {
            const row = Math.floor(index / 10);
            const col = index % 10;
            matrix[row][col] = Math.random() > 0.5 ? 1 : 0;
            if (matrix[row][col] === 1) {
                cell.classList.add('active');
            } else {
                cell.classList.remove('active');
            }
        });
    }

    function updateValue(id) {
        const element = document.getElementById(id);
        const display = document.getElementById(id + 'Value');
        if (id === 'screenDistance') {
            display.textContent = parseFloat(element.value).toFixed(2) + ' м';
        } else if (id === 'numElectrons') {
            display.textContent = parseInt(element.value).toLocaleString('ru-RU');
        } else if (id === 'wavelength') {
            display.textContent = element.value + ' пм';
        } else {
            display.textContent = element.value;
        }
    }

    function updateApertureOptions() {
        const apertureType = document.getElementById('apertureType').value;
        document.querySelectorAll('.aperture-options').forEach(el => { el.classList.remove('active'); });
        if (apertureType === 'single') {
            document.getElementById('slitOptions').classList.add('active');
            document.getElementById('separationGroup').style.display = 'none';
        } else if (apertureType === 'double' || apertureType === 'triple') {
            document.getElementById('slitOptions').classList.add('active');
            document.getElementById('separationGroup').style.display = 'block';
        } else if (apertureType === 'n_slit') {
            document.getElementById('nSlitOptions').classList.add('active');
        } else if (apertureType === 'circle') {
            document.getElementById('circleOptions').classList.add('active');
        } else if (apertureType === 'image') {
            document.getElementById('imageOptions').classList.add('active');
        } else if (apertureType === 'matrix') {
            document.getElementById('matrixOptions').classList.add('active');
        }
    }

    function handleImageUpload(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImage = e.target.result;
                document.getElementById('fileLabel').textContent = file.name;
            };
            reader.readAsDataURL(file);
        }
    }

    async function calculate() {
        const button = document.getElementById('calculateBtn');
        const loading = document.getElementById('loading');
        button.disabled = true;
        loading.classList.add('active');

        const apertureType = document.getElementById('apertureType').value;
        const showAnalytical = document.getElementById('showAnalytical').checked;

        let data = {
            aperture_type: apertureType,
            screen_distance: parseFloat(document.getElementById('screenDistance').value),
            num_electrons: parseInt(document.getElementById('numElectrons').value),
            wavelength: parseFloat(document.getElementById('wavelength').value) * 1e-12,
            pixel_size: 1e-7
        };

        if (apertureType === 'single' || apertureType === 'double' || apertureType === 'triple') {
            data.slit_width = parseInt(document.getElementById('slitWidth').value);
            data.slit_separation = parseInt(document.getElementById('slitSeparation').value);
        }
        if (apertureType === 'n_slit') {
            data.n_slits = parseInt(document.getElementById('nSlits').value);
            data.slit_width = parseInt(document.getElementById('nSlitWidth').value);
            data.slit_separation = parseInt(document.getElementById('nSlitSeparation').value);
        }
        if (apertureType === 'circle') {
            data.circle_radius = parseInt(document.getElementById('circleRadius').value);
        }
        if (apertureType === 'image') {
            data.image_data = uploadedImage;
        }
        if (apertureType === 'matrix') {
            data.matrix_data = matrix;
        }

        try {
            const endpoint = showAnalytical ? '/calculate_analytical' : '/calculate';
            const response = await fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await response.json();

            if (result.success) {
                showImage('apertureImage', 'aperturePlaceholder', result.aperture);
                showImage('fresnelImage', 'fresnelPlaceholder', result.fresnel);
                showImage('fraunhoferImage', 'fraunhoferPlaceholder', result.fraunhofer);

                document.getElementById('infoPanel').style.display = 'block';
                document.getElementById('fresnelNumber').textContent = result.fresnel_number.toExponential(2);
                const F = result.fresnel_number;
                let regime;
                if (F > 10) { regime = 'Ближняя зона (Френель)'; }
                else if (F < 0.1) { regime = 'Дальняя зона (Фраунгофер)'; }
                else { regime = 'Переходная зона'; }
                document.getElementById('regimeInfo').textContent = regime;
                document.getElementById('algorithmInfo').textContent = result.algorithm;
                document.getElementById('electronCount').textContent = result.info.electrons.toLocaleString('ru-RU');
                document.getElementById('distanceInfo').textContent = result.info.distance.toFixed(2) + ' м';
            } else {
                alert('Ошибка: ' + result.error);
                console.error(result.traceback);
            }
        } catch (error) {
            alert('Ошибка соединения: ' + error.message);
            console.error(error);
        }

        button.disabled = false;
        loading.classList.remove('active');
    }

    function showImage(imgId, placeholderId, src) {
        const img = document.getElementById(imgId);
        const placeholder = document.getElementById(placeholderId);
        img.src = src;
        img.style.display = 'block';
        placeholder.style.display = 'none';
    }

    document.addEventListener('DOMContentLoaded', function() {
        updateApertureOptions();
        initMatrix();
        const cells = document.querySelectorAll('.matrix-cell');
        [44, 45, 54, 55].forEach(idx => {
            const row = Math.floor(idx / 10);
            const col = idx % 10;
            matrix[row][col] = 1;
            cells[idx].classList.add('active');
        });
    });
</script>
</body>
</html>